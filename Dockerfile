FROM ubuntu:14.04

RUN apt-get update && \
    apt-get install -y wget build-essential

RUN wget https://www.openssl.org/source/openssl-1.0.1f.tar.gz && \
    tar -xzf openssl-1.0.1f.tar.gz && \
    cd openssl-1.0.1f && \
    ./config && make && make install_sw

RUN ln -sf /usr/local/ssl/bin/openssl /usr/bin/openssl && \
    openssl version

RUN mkdir -p /usr/local/ssl/private /usr/local/ssl/certs && \
    openssl req -x509 -newkey rsa:2048 -keyout /usr/local/ssl/private/test.key -out /usr/local/ssl/certs/test.crt -days 365 -nodes -subj "/C=SG/ST=Singapore/L=Singapore/O=NTU/OU=SC3010/CN=heartbleed/emailAddress=heartbleed@demo.com"

EXPOSE 443

CMD ["sh", "-c", "openssl version && openssl s_server -cert /usr/local/ssl/certs/test.crt -key /usr/local/ssl/private/test.key -accept 443 -www"]